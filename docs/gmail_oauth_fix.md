# Gmail OAuth 测试模式解决方案

## 问题描述
当访问 OAuth 认证 URL 时提示："TDXAgent"尚未完成 Google 验证流程。此应用正在测试中，仅供已获开发者批准的测试人员使用。

## 解决方案

### 方法 1: 添加测试用户（推荐，立即生效）

1. **返回 Google Cloud Console**
   - 访问：https://console.cloud.google.com/
   - 选择你的 TDXAgent 项目

2. **进入 OAuth 同意屏幕设置**
   ```
   导航路径：API和服务 → OAuth 同意屏幕
   ```

3. **编辑应用信息**
   - 点击 "编辑应用"
   - 滚动到底部找到 "测试用户" 部分

4. **添加测试用户**
   ```
   点击 "+ 添加用户"
   输入你的 Gmail 邮箱地址（完整邮箱，如：your-email@gmail.com）
   点击 "保存"
   ```

5. **保存并发布（可选）**
   - 点击 "保存并继续"
   - 完成所有步骤

### 方法 2: 发布应用到生产环境（需要审核，3-7天）

如果你想让应用对所有用户开放，可以申请发布：

1. **完善应用信息**
   ```
   - 应用名称：TDXAgent
   - 用户支持电子邮件：你的邮箱
   - 应用主页：可以填写 GitHub 仓库地址
   - 应用隐私政策：说明应用只读取邮件用于个人分析
   - 应用服务条款：说明这是个人使用工具
   ```

2. **提交审核**
   ```
   点击 "发布应用"
   填写审核信息
   等待 Google 审核（通常 3-7 个工作日）
   ```

### 方法 3: 使用个人 Google 账户作为开发者（最简单）

如果你使用的是个人 Google 账户创建的项目：

1. **确认开发者邮箱**
   - 确保你使用的是同一个 Google 账户
   - 该账户自动有测试权限

2. **检查浏览器登录状态**
   - 确保浏览器登录的是创建项目的同一个 Google 账户
   - 清除浏览器缓存后重试

## 验证步骤

完成上述任一方法后：

1. **重新运行测试**
   ```bash
   python test_gmail_setup.py
   ```

2. **如果仍然提示认证错误**
   - 等待 5-10 分钟（Google 设置生效需要时间）
   - 清除浏览器缓存
   - 使用无痕模式重新认证

3. **成功标志**
   - 浏览器显示 Google 权限授权页面
   - 可以点击 "允许" 授权 Gmail 只读权限
   - 认证完成后会显示 "认证成功" 或重定向到 localhost

## 常见问题

### Q: 为什么会出现这个问题？
A: Google OAuth 应用默认在 "测试模式"，只允许开发者和指定的测试用户使用。

### Q: 添加测试用户后多久生效？
A: 通常 5-10 分钟内生效，最长可能需要 1 小时。

### Q: 我可以添加多少个测试用户？
A: 测试模式下最多可以添加 100 个测试用户。

### Q: 发布到生产环境有什么要求？
A: 需要提供隐私政策、服务条款，并通过 Google 的安全审核。

## 推荐做法

对于个人使用的 TDXAgent：
1. **优先使用方法 1**：添加自己的邮箱为测试用户
2. **如果需要分享给朋友**：可以添加他们的邮箱为测试用户
3. **如果要公开发布**：考虑方法 2，但需要更多合规工作